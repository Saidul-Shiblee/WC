<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="style.css" rel="stylesheet">
    <title>Order Details</title>
</head>
<body onload="getOrderdetails()"> 

<div class="flex w-full h-screen ">
    <div class="flex flex-col w-1/6 bg-sky-50 h-screen ">
            <ul class="flex flex-col gap-4 items-center pt-6">
                <li class="flex grow-0 hover:bg-sky-600">
                    Place Order
                </li>
                <li>
                    Order Status
                </li>
               
            </ul>
    </div>
    <div class="flex flex-col w-5/6 bg-gray-500  ">
        <div class="flex flex-col ">
            <div class="flex drop-shadow-md bg-white w-full p-2 mb-4 justify-center">
                <h1 class="text-slate-800 text-3xl ">Hi <span id="user"></span> here is your order details</h1>
            </div>
        </div>
        <div class="flex flex-col bg-zinc-50  p-12">
            <div class="flex justify-around w-full p-2">
                <div class="flex ">Order #</div>
                <div class="flex"> Order Details</div>
                <div class="flex">OPD</div>
                <div class="flex">EDD</div>
                <div class="flex">Status</div>
                <div class="flex"></div>
            </div>
            <div class="border-b-2 border-indigo-500"></div>
            <div id="demo" class="t_content"></div>
        </div>
        
        <div class="modal fixed  ease-linear transition-all  duration-300 flex justify-around  update bg-white border-0 rounded-lg p-20 drop-shadow-2xl transform -translate-x-1/2 -translate-y-96 left-2/4 ">
            <div><label for="">EDD</label>
             <input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500  w-auto p-2.5" type="date" id= 'edd' value=""> 
            </div>
             <div>
             <label for="">Status</label>
             <select id="status" class="form-select appearance-none block w-full px-3 py-1.5 text-base font-normal
                       text-gray-700 bg-white bg-clip-padding bg-no-repeat border border-solid border-gray-300
                       rounded transition ease-in-outm-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" >
             </select>
             </div>
             <a href="" onclick='update()' class ="bg-blue-500 w-auto  border-0 rounded-md p-1 mr-2 text-white cursor-default">Update</a>
         </div>
         <div>
             <p id="index" hidden></p>
         </div>
    </div>
</div>
      
  
    
</body>

<script>


function getOrderdetails(){

    UserID= JSON.parse(localStorage.getItem('UserID'));
    if(!UserID){window.location.href = "Signin-admin.html"}
    Orders= JSON.parse(localStorage.getItem('Orders'))
    Users=JSON.parse(localStorage.getItem('Users'))
    t_content=document.querySelector(".t_content")
    user_name=document.querySelector("#user")
    Users.filter((user)=>{
        if (UserID==user.email) {
           UserName=user.name 
           user_name.innerHTML=UserName
        }
    })
    let content=""
    Orders.filter((order,index)=>{          
            let element=[]
            for (let member in order.order_items) {
                element.push(member+"->"+order.order_items[member])  
            }
            content+=
                `<div class="flex justify-around  p-2 border-bottom border-dotted border-indigo-500 ">
                <div class="  grow-1">${order.order_id}</div>   
                <div class="  grow-0">${element.map((el)=>el).join(',')}</div>       
                <div class=" grow-0">${order.Order_PD}</div>
                <div class=" grow-1">${order.Order_EDD}</div>
                <div class="  grow-0">${order.Order_status}</div>
                <div class="  grow-0">
                    <p  onclick='edit(${index})' class ="bg-blue-500 w-auto  border-0 rounded-md p-1 mr-2 text-white cursor-default active:bg-blue-400">Edit</p>
                    <p  class ="bg-red-700 w-auto  border-0 rounded-md p-1 text-white cursor-default">Delete</p>
                </div>
                </div>` 
    })
    t_content.innerHTML=content
}

function edit(id){
    let edd=document.querySelector("#edd")
    let status=document.querySelector("#status")
    let ind=document.querySelector("#index")
    let modal=document.querySelector('.modal')
    console.log(status.value);
    const Order_Status=['','Not Yet Confirmed','Order Received','In Progress','Ready for Delivery','Delivered']
    Orders= JSON.parse(localStorage.getItem('Orders'))
    Orders.filter((order,index)=>{
        if (id==index) {
            edd.value= order.Order_EDD
            status.value= order.Order_status
            ind.innerHTML=index
            console.log(status.value);
            let select=``
            Order_Status.map((el)=>{
            select+= 
            `
             <option ${el==order.Order_status?"selected":""} value="${el}">${el}</option>
            `})
             console.log(select);
             status.innerHTML=select   
           }
    })
    modal.classList.remove('-translate-y-96');   
}  

function update(){
    
    Orders= JSON.parse(localStorage.getItem('Orders'))
    console.log(JSON.stringify(Orders));
    let ind=document.querySelector("#index").innerHTML;
    let edd=document.querySelector("#edd").value;
    let status=document.querySelector("#status").value;
    let modal=document.querySelector('.modal')
    
    order=Orders[ind];
    // console.log(order);
    let update_order={ 'order_id':order.order_id,
      'order_items':order.order_items,
       "user_id":order.user_id,
       'Order_status':status,
       'Order_PD':order.Order_PD,
       'Order_EDD':edd,
                     }
    Orders.splice(ind, 1, update_order);
    localStorage.setItem('Orders',JSON.stringify(Orders));
    modal.classList.add('-translate-y-96'); 
}


</script>
</html>

